!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():e.applyKov=r()}(this,function(){var e,r={}.hasOwnProperty;return e=function(e){return e.extenders.fallible=function(n,o){var t,s,l,i,u,f;return o===!1?("function"==typeof n._disposeFallible&&n._disposeFallible(),n):e.extenders.fallible.isFallible(n)?n:(l=e.observable({}),u=0,i={}.hasOwnProperty,f=function(e){var r;r=l(),i.call(r,e)&&(delete r[e],l.valueHasMutated())},t=function(e){return i.call(l(),e)},s=function(e,r,o){var s;return null!=r?(s={message:o,target:n,dispose:function(){return f(r)},isDisposed:function(){return!t(r)}},e[r]=o):s={message:o,target:n,dispose:function(){},isDisposed:function(){return!0}},s},n.errors=e.pureComputed({read:function(){var e,n,o,t,s;t=[],e=function(r){var n,o,s;if(null!=r)if("function"==typeof r)r=r(),e(r);else if(Array.isArray(r))for(n=0,o=r.length;o>n;n++)s=r[n],e(s);else"string"==typeof r||"object"==typeof r?t.push(r):"undefined"!=typeof console&&null!==console&&"function"==typeof console.assert&&console.assert(!1,"invalid error message")},s=l();for(n in s)r.call(s,n)&&(o=s[n],e(o));return t},write:function(e){n.errors.set(e)}}),n.errors.add=function(e){var r,n;return null!=e&&(r=++u),n=s(l(),r,e),l.valueHasMutated(),n},n.errors.get=function(){var e,n,o,t,s;n=void 0,e=function(r){var o,t,s;if(null==r)return!1;if("function"==typeof r){if(r=r(),e(r))return!0}else if(Array.isArray(r)){for(o=0,t=r.length;t>o;o++)if(s=r[o],e(s))return!0}else{if("string"==typeof r||"object"==typeof r)return n=r,!0;"undefined"!=typeof console&&null!==console&&"function"==typeof console.assert&&console.assert(!1,"invalid error message")}return!1},s=l();for(o in s)if(r.call(s,o)&&(t=s[o],e(t)))return n},n.errors.set=function(e){var r,n,o;return null!=e&&(n=++u),r={},o=s(r,n,e),l(r),o},n.errors.has=function(){return null!=n.error()},n.errors.clear=function(){l({})},n.error=e.pureComputed({read:n.errors.get,write:n.errors.set}),n.hasError=e.pureComputed({read:n.errors.has}),n._disposeFallible=function(){l({}),delete n.error,delete n.errors,delete n.hasError,delete n._disposeFallible},n)},e.extenders.fallible.isFallible=function(e){return null!=e.errors&&null!=e.error},e.pureErrors=function(r,n){var o,t;return t=void 0,o=e.pureComputed(function(){var e,s,l;l=[],e=function(e,r){null!=e?(e=e.extend({fallible:!0}),l.push(e.errors.add(r))):l.push({message:r,dispose:function(){},isDisposed:function(){return!0}})},s=function(){var e,r,n;for(r=0,n=l.length;n>r;r++)e=l[r],e.dispose();l=[],t.dispose(),t=void 0};try{r.call(n,e)}finally{t=o.subscribe(s,null,"asleep")}return l})},e}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImtvLXZhbGlkYXRpb24tYmFzZS51bWQuanMiLCJrby12YWxpZGF0aW9uLWJhc2UuY29mZmVlIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsImFwcGx5S292IiwidGhpcyIsImhhc1Byb3AiLCJoYXNPd25Qcm9wZXJ0eSIsImtvIiwiZXh0ZW5kZXJzIiwiZmFsbGlibGUiLCJ0YXJnZXQiLCJvcHRpb25zIiwiX2Vycm9yRXhpc3RzIiwiX2Vycm9yTWV0YURhdGEiLCJfZXJyb3JzIiwiX2hhc093blByb3AiLCJfaWRDb3VudGVyIiwiX3JlbW92ZUVycm9yIiwiX2Rpc3Bvc2VGYWxsaWJsZSIsImlzRmFsbGlibGUiLCJvYnNlcnZhYmxlIiwiaWQiLCJlcnJvcnMiLCJjYWxsIiwidmFsdWVIYXNNdXRhdGVkIiwibWVzc2FnZSIsIm1ldGFEYXRhIiwiZGlzcG9zZSIsImlzRGlzcG9zZWQiLCJwdXJlQ29tcHV0ZWQiLCJyZWFkIiwiYWRkTWVzc2FnZSIsIm1lc3NhZ2VzIiwicmVmIiwiaSIsImxlbiIsInN1Yk1lc3NhZ2UiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJwdXNoIiwiY29uc29sZSIsImFzc2VydCIsIndyaXRlIiwic2V0IiwiYWRkIiwiZ2V0IiwiZmluZE1lc3NhZ2UiLCJmaXJzdE1lc3NhZ2UiLCJoYXMiLCJlcnJvciIsImNsZWFyIiwiaGFzRXJyb3IiLCJwdXJlRXJyb3JzIiwib3duZXIiLCJjb21wdXRlZCIsInN1YnNjcmlwdGlvbiIsImFkZEVycm9yIiwiZXh0ZW5kIiwic3Vic2NyaWJlIl0sIm1hcHBpbmdzIjoiQ0FBRSxTQUFTQSxFQUFNQyxHQUNPLGtCQUFYQyxTQUF5QkEsT0FBT0MsSUFDekNELFVBQVdELEdBQ2lCLGdCQUFaRyxTQUNoQkMsT0FBT0QsUUFBVUgsSUFFakJELEVBQUtNLFNBQVdMLEtBRWxCTSxLQUFNLFdBQ1IsR0FBSUQsR0NUSkUsS0FBQUMsY0QyT0Es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QUFoQixFQUFBQyxDQUFBLEtBQUFELEVBQUEsRUFBQUMsRUFBQWIsRUFBQWlCLE9BQUFKLEVBQUFELEVBQUFBLElEMkJBZ0IsRUFBUTVCLEVBQU9ZLEdDMUJiZ0IsRUFBTXZCLFNBQ1JMLE1BQ0FrQyxFQUFhN0IsVUFDYjZCLEVBQWUsT0FHakIsS0FDRTFCLEVBQUtQLEtBQUsrQixFQUFPRyxHQURuQixRQUdFRCxFQUFlRCxFQUFTSSxVQUFVaEMsRUFBUyxLQUFNLFVBRW5ELE1BQU9MLE1BS05mIiwiZmlsZSI6ImtvLXZhbGlkYXRpb24tYmFzZS51bWQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiOyhmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7XHJcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgZGVmaW5lKFtdLCBmYWN0b3J5KTtcclxuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xyXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJvb3QuYXBwbHlLb3YgPSBmYWN0b3J5KCk7XHJcbiAgfVxyXG59KHRoaXMsIGZ1bmN0aW9uKCkge1xyXG52YXIgYXBwbHlLb3YsXG4gIGhhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eTtcblxuYXBwbHlLb3YgPSBmdW5jdGlvbihrbykge1xuICBrby5leHRlbmRlcnMuZmFsbGlibGUgPSBmdW5jdGlvbih0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICB2YXIgX2Vycm9yRXhpc3RzLCBfZXJyb3JNZXRhRGF0YSwgX2Vycm9ycywgX2hhc093blByb3AsIF9pZENvdW50ZXIsIF9yZW1vdmVFcnJvcjtcbiAgICBpZiAob3B0aW9ucyA9PT0gZmFsc2UpIHtcbiAgICAgIGlmICh0eXBlb2YgdGFyZ2V0Ll9kaXNwb3NlRmFsbGlibGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICB0YXJnZXQuX2Rpc3Bvc2VGYWxsaWJsZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG4gICAgaWYgKGtvLmV4dGVuZGVycy5mYWxsaWJsZS5pc0ZhbGxpYmxlKHRhcmdldCkpIHtcbiAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuICAgIF9lcnJvcnMgPSBrby5vYnNlcnZhYmxlKHt9KTtcbiAgICBfaWRDb3VudGVyID0gMDtcbiAgICBfaGFzT3duUHJvcCA9IHt9Lmhhc093blByb3BlcnR5O1xuICAgIF9yZW1vdmVFcnJvciA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICB2YXIgZXJyb3JzO1xuICAgICAgZXJyb3JzID0gX2Vycm9ycygpO1xuICAgICAgaWYgKF9oYXNPd25Qcm9wLmNhbGwoZXJyb3JzLCBpZCkpIHtcbiAgICAgICAgZGVsZXRlIGVycm9yc1tpZF07XG4gICAgICAgIF9lcnJvcnMudmFsdWVIYXNNdXRhdGVkKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBfZXJyb3JFeGlzdHMgPSBmdW5jdGlvbihpZCkge1xuICAgICAgcmV0dXJuIF9oYXNPd25Qcm9wLmNhbGwoX2Vycm9ycygpLCBpZCk7XG4gICAgfTtcbiAgICBfZXJyb3JNZXRhRGF0YSA9IGZ1bmN0aW9uKGVycm9ycywgaWQsIG1lc3NhZ2UpIHtcbiAgICAgIHZhciBtZXRhRGF0YTtcbiAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgIG1ldGFEYXRhID0ge1xuICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gX3JlbW92ZUVycm9yKGlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlzRGlzcG9zZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICFfZXJyb3JFeGlzdHMoaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZXJyb3JzW2lkXSA9IG1lc3NhZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXRhRGF0YSA9IHtcbiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlzRGlzcG9zZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1ldGFEYXRhO1xuICAgIH07XG4gICAgdGFyZ2V0LmVycm9ycyA9IGtvLnB1cmVDb21wdXRlZCh7XG4gICAgICByZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFkZE1lc3NhZ2UsIGlkLCBtZXNzYWdlLCBtZXNzYWdlcywgcmVmO1xuICAgICAgICBtZXNzYWdlcyA9IFtdO1xuICAgICAgICBhZGRNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgIHZhciBpLCBsZW4sIHN1Yk1lc3NhZ2U7XG4gICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlKCk7XG4gICAgICAgICAgICBhZGRNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShtZXNzYWdlKSkge1xuICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gbWVzc2FnZS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICBzdWJNZXNzYWdlID0gbWVzc2FnZVtpXTtcbiAgICAgICAgICAgICAgYWRkTWVzc2FnZShzdWJNZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgbWVzc2FnZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZS5hc3NlcnQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuYXNzZXJ0KGZhbHNlLCAnaW52YWxpZCBlcnJvciBtZXNzYWdlJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJlZiA9IF9lcnJvcnMoKTtcbiAgICAgICAgZm9yIChpZCBpbiByZWYpIHtcbiAgICAgICAgICBpZiAoIWhhc1Byb3AuY2FsbChyZWYsIGlkKSkgY29udGludWU7XG4gICAgICAgICAgbWVzc2FnZSA9IHJlZltpZF07XG4gICAgICAgICAgYWRkTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWVzc2FnZXM7XG4gICAgICB9LFxuICAgICAgd3JpdGU6IGZ1bmN0aW9uKG1lc3NhZ2VzKSB7XG4gICAgICAgIHRhcmdldC5lcnJvcnMuc2V0KG1lc3NhZ2VzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0YXJnZXQuZXJyb3JzLmFkZCA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgIHZhciBpZCwgbWV0YURhdGE7XG4gICAgICBpZiAobWVzc2FnZSAhPSBudWxsKSB7XG4gICAgICAgIGlkID0gKytfaWRDb3VudGVyO1xuICAgICAgfVxuICAgICAgbWV0YURhdGEgPSBfZXJyb3JNZXRhRGF0YShfZXJyb3JzKCksIGlkLCBtZXNzYWdlKTtcbiAgICAgIF9lcnJvcnMudmFsdWVIYXNNdXRhdGVkKCk7XG4gICAgICByZXR1cm4gbWV0YURhdGE7XG4gICAgfTtcbiAgICB0YXJnZXQuZXJyb3JzLmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGZpbmRNZXNzYWdlLCBmaXJzdE1lc3NhZ2UsIGlkLCBtZXNzYWdlLCByZWY7XG4gICAgICBmaXJzdE1lc3NhZ2UgPSB2b2lkIDA7XG4gICAgICBmaW5kTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIGksIGxlbiwgc3ViTWVzc2FnZTtcbiAgICAgICAgaWYgKG1lc3NhZ2UgPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlKCk7XG4gICAgICAgICAgaWYgKGZpbmRNZXNzYWdlKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShtZXNzYWdlKSkge1xuICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG1lc3NhZ2UubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIHN1Yk1lc3NhZ2UgPSBtZXNzYWdlW2ldO1xuICAgICAgICAgICAgaWYgKGZpbmRNZXNzYWdlKHN1Yk1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIG1lc3NhZ2UgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgZmlyc3RNZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlLmFzc2VydCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuYXNzZXJ0KGZhbHNlLCAnaW52YWxpZCBlcnJvciBtZXNzYWdlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH07XG4gICAgICByZWYgPSBfZXJyb3JzKCk7XG4gICAgICBmb3IgKGlkIGluIHJlZikge1xuICAgICAgICBpZiAoIWhhc1Byb3AuY2FsbChyZWYsIGlkKSkgY29udGludWU7XG4gICAgICAgIG1lc3NhZ2UgPSByZWZbaWRdO1xuICAgICAgICBpZiAoZmluZE1lc3NhZ2UobWVzc2FnZSkpIHtcbiAgICAgICAgICByZXR1cm4gZmlyc3RNZXNzYWdlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH07XG4gICAgdGFyZ2V0LmVycm9ycy5zZXQgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICB2YXIgZXJyb3JzLCBpZCwgbWV0YURhdGE7XG4gICAgICBpZiAobWVzc2FnZSAhPSBudWxsKSB7XG4gICAgICAgIGlkID0gKytfaWRDb3VudGVyO1xuICAgICAgfVxuICAgICAgZXJyb3JzID0ge307XG4gICAgICBtZXRhRGF0YSA9IF9lcnJvck1ldGFEYXRhKGVycm9ycywgaWQsIG1lc3NhZ2UpO1xuICAgICAgX2Vycm9ycyhlcnJvcnMpO1xuICAgICAgcmV0dXJuIG1ldGFEYXRhO1xuICAgIH07XG4gICAgdGFyZ2V0LmVycm9ycy5oYXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0YXJnZXQuZXJyb3IoKSAhPSBudWxsO1xuICAgIH07XG4gICAgdGFyZ2V0LmVycm9ycy5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgX2Vycm9ycyh7fSk7XG4gICAgfTtcbiAgICB0YXJnZXQuZXJyb3IgPSBrby5wdXJlQ29tcHV0ZWQoe1xuICAgICAgcmVhZDogdGFyZ2V0LmVycm9ycy5nZXQsXG4gICAgICB3cml0ZTogdGFyZ2V0LmVycm9ycy5zZXRcbiAgICB9KTtcbiAgICB0YXJnZXQuaGFzRXJyb3IgPSBrby5wdXJlQ29tcHV0ZWQoe1xuICAgICAgcmVhZDogdGFyZ2V0LmVycm9ycy5oYXNcbiAgICB9KTtcbiAgICB0YXJnZXQuX2Rpc3Bvc2VGYWxsaWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgX2Vycm9ycyh7fSk7XG4gICAgICBkZWxldGUgdGFyZ2V0LmVycm9yO1xuICAgICAgZGVsZXRlIHRhcmdldC5lcnJvcnM7XG4gICAgICBkZWxldGUgdGFyZ2V0Lmhhc0Vycm9yO1xuICAgICAgZGVsZXRlIHRhcmdldC5fZGlzcG9zZUZhbGxpYmxlO1xuICAgIH07XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcbiAga28uZXh0ZW5kZXJzLmZhbGxpYmxlLmlzRmFsbGlibGUgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICByZXR1cm4gKHRhcmdldC5lcnJvcnMgIT0gbnVsbCkgJiYgKHRhcmdldC5lcnJvciAhPSBudWxsKTtcbiAgfTtcbiAga28ucHVyZUVycm9ycyA9IGZ1bmN0aW9uKHJlYWQsIG93bmVyKSB7XG4gICAgdmFyIGNvbXB1dGVkLCBzdWJzY3JpcHRpb247XG4gICAgc3Vic2NyaXB0aW9uID0gdm9pZCAwO1xuICAgIGNvbXB1dGVkID0ga28ucHVyZUNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFkZEVycm9yLCBkaXNwb3NlLCBlcnJvcnM7XG4gICAgICBlcnJvcnMgPSBbXTtcbiAgICAgIGFkZEVycm9yID0gZnVuY3Rpb24odGFyZ2V0LCBtZXNzYWdlKSB7XG4gICAgICAgIGlmICh0YXJnZXQgIT0gbnVsbCkge1xuICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5leHRlbmQoe1xuICAgICAgICAgICAgZmFsbGlibGU6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBlcnJvcnMucHVzaCh0YXJnZXQuZXJyb3JzLmFkZChtZXNzYWdlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRGlzcG9zZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGVycm9yLCBpLCBsZW47XG4gICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGVycm9ycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGVycm9yID0gZXJyb3JzW2ldO1xuICAgICAgICAgIGVycm9yLmRpc3Bvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBlcnJvcnMgPSBbXTtcbiAgICAgICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgICAgICAgc3Vic2NyaXB0aW9uID0gdm9pZCAwO1xuICAgICAgfTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJlYWQuY2FsbChvd25lciwgYWRkRXJyb3IpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgc3Vic2NyaXB0aW9uID0gY29tcHV0ZWQuc3Vic2NyaWJlKGRpc3Bvc2UsIG51bGwsICdhc2xlZXAnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbXB1dGVkO1xuICB9O1xuICByZXR1cm4ga287XG59O1xuXHJcbnJldHVybiBhcHBseUtvdjtcclxufSkpO1xyXG4iLCJhcHBseUtvdiA9IChrbykgLT5cclxuICBrby5leHRlbmRlcnMuZmFsbGlibGUgPSAodGFyZ2V0LCBvcHRpb25zKSAtPlxyXG4gICAgIyBEaXNwb3NlP1xyXG4gICAgaWYgb3B0aW9ucyA9PSBmYWxzZVxyXG4gICAgICB0YXJnZXQuX2Rpc3Bvc2VGYWxsaWJsZT8oKVxyXG4gICAgICByZXR1cm4gdGFyZ2V0XHJcblxyXG4gICAgIyBBbHJlYWR5IGNvbnN0cnVjdGVkXHJcbiAgICBpZiBrby5leHRlbmRlcnMuZmFsbGlibGUuaXNGYWxsaWJsZSh0YXJnZXQpXHJcbiAgICAgIHJldHVybiB0YXJnZXRcclxuXHJcbiAgICAjIGNvbnRhaW5zIHRoZSBlcnJvcnMgZm9yIHRhcmdldFxyXG4gICAgX2Vycm9ycyA9IGtvLm9ic2VydmFibGUoe30pXHJcblxyXG4gICAgIyB1c2VkIGZvciBnZW5lcmF0aW5nIGEgdW5pcXVlIGlkIGZvciBlYWNoIGVycm9yXHJcbiAgICBfaWRDb3VudGVyID0gMFxyXG5cclxuICAgICMgaGVscGVyIGZvciBjYWxsaW5nIGhhc093blByb3BlcnR5XHJcbiAgICBfaGFzT3duUHJvcCA9ICh7fSkuaGFzT3duUHJvcGVydHlcclxuXHJcbiAgICAjIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBlcnJvciwgaWYgaXQgZXhpc3RzXHJcbiAgICBfcmVtb3ZlRXJyb3IgPSAoaWQpIC0+XHJcbiAgICAgIGVycm9ycyA9IF9lcnJvcnMoKVxyXG5cclxuICAgICAgaWYgX2hhc093blByb3AuY2FsbChlcnJvcnMsIGlkKVxyXG4gICAgICAgIGRlbGV0ZSBlcnJvcnNbaWRdXHJcbiAgICAgICAgX2Vycm9ycy52YWx1ZUhhc011dGF0ZWQoKVxyXG5cclxuICAgICAgcmV0dXJuXHJcblxyXG4gICAgIyBSZXR1cm5zIHRydWUgaWZmIHRoZSBzcGVjaWZpZWQgZXJyb3IgZXhpc3RzXHJcbiAgICBfZXJyb3JFeGlzdHMgPSAoaWQpIC0+XHJcbiAgICAgIF9oYXNPd25Qcm9wLmNhbGwoX2Vycm9ycygpLCBpZClcclxuXHJcbiAgICBfZXJyb3JNZXRhRGF0YSA9IChlcnJvcnMsIGlkLCBtZXNzYWdlKSAtPlxyXG4gICAgICBpZiBpZD9cclxuICAgICAgICBtZXRhRGF0YSA9IHtcclxuICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VcclxuICAgICAgICAgIHRhcmdldDogdGFyZ2V0XHJcbiAgICAgICAgICBkaXNwb3NlOiAoKSAtPlxyXG4gICAgICAgICAgICBfcmVtb3ZlRXJyb3IoaWQpXHJcbiAgICAgICAgICBpc0Rpc3Bvc2VkOiAoKSAtPlxyXG4gICAgICAgICAgICBub3QgX2Vycm9yRXhpc3RzKGlkKVxyXG4gICAgICAgIH1cclxuICAgICAgICBlcnJvcnNbaWRdID0gbWVzc2FnZVxyXG4gICAgICBlbHNlXHJcbiAgICAgICAgbWV0YURhdGEgPSB7XHJcbiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXHJcbiAgICAgICAgICB0YXJnZXQ6IHRhcmdldFxyXG4gICAgICAgICAgZGlzcG9zZTogKCkgLT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICBpc0Rpc3Bvc2VkOiAoKSAtPiB0cnVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIG1ldGFEYXRhXHJcblxyXG4gICAgIyBBIGxpc3Qgb2YgYWxsIGVycm9yc1xyXG4gICAgdGFyZ2V0LmVycm9ycyA9IGtvLnB1cmVDb21wdXRlZCh7XHJcbiAgICAgIHJlYWQ6ICgpIC0+XHJcbiAgICAgICAgbWVzc2FnZXMgPSBbXVxyXG5cclxuICAgICAgICBhZGRNZXNzYWdlID0gKG1lc3NhZ2UpIC0+XHJcbiAgICAgICAgICBpZiBub3QgbWVzc2FnZT9cclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICBlbHNlIGlmIHR5cGVvZiBtZXNzYWdlID09ICdmdW5jdGlvbidcclxuICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UoKVxyXG4gICAgICAgICAgICBhZGRNZXNzYWdlKG1lc3NhZ2UpXHJcbiAgICAgICAgICBlbHNlIGlmIEFycmF5LmlzQXJyYXkobWVzc2FnZSlcclxuICAgICAgICAgICAgZm9yIHN1Yk1lc3NhZ2UgaW4gbWVzc2FnZVxyXG4gICAgICAgICAgICAgIGFkZE1lc3NhZ2Uoc3ViTWVzc2FnZSlcclxuICAgICAgICAgIGVsc2UgaWYgdHlwZW9mIG1lc3NhZ2UgPT0gJ3N0cmluZycgb3IgdHlwZW9mIG1lc3NhZ2UgPT0gJ29iamVjdCdcclxuICAgICAgICAgICAgbWVzc2FnZXMucHVzaChtZXNzYWdlKVxyXG4gICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBjb25zb2xlPy5hc3NlcnQ/KGZhbHNlLCAnaW52YWxpZCBlcnJvciBtZXNzYWdlJylcclxuXHJcbiAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgZm9yIG93biBpZCwgbWVzc2FnZSBvZiBfZXJyb3JzKClcclxuICAgICAgICAgIGFkZE1lc3NhZ2UobWVzc2FnZSlcclxuXHJcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VzXHJcblxyXG4gICAgICB3cml0ZTogKG1lc3NhZ2VzKSAtPlxyXG4gICAgICAgIHRhcmdldC5lcnJvcnMuc2V0KG1lc3NhZ2VzKVxyXG4gICAgICAgIHJldHVyblxyXG4gICAgfSlcclxuXHJcbiAgICAjIEFkZCBhbiBpbmRpdmlkdWFsIGVycm9yXHJcbiAgICB0YXJnZXQuZXJyb3JzLmFkZCA9IChtZXNzYWdlKSAtPlxyXG4gICAgICBpZiBtZXNzYWdlP1xyXG4gICAgICAgIGlkID0gKytfaWRDb3VudGVyXHJcblxyXG4gICAgICBtZXRhRGF0YSA9IF9lcnJvck1ldGFEYXRhKF9lcnJvcnMoKSwgaWQsIG1lc3NhZ2UpXHJcbiAgICAgIF9lcnJvcnMudmFsdWVIYXNNdXRhdGVkKClcclxuXHJcbiAgICAgIHJldHVybiBtZXRhRGF0YVxyXG5cclxuICAgICMgR2V0IHRoZSBmaXJzdCBlcnJvclxyXG4gICAgdGFyZ2V0LmVycm9ycy5nZXQgPSAoKSAtPlxyXG4gICAgICBmaXJzdE1lc3NhZ2UgPSB1bmRlZmluZWRcclxuXHJcbiAgICAgIGZpbmRNZXNzYWdlID0gKG1lc3NhZ2UpIC0+XHJcbiAgICAgICAgaWYgbm90IG1lc3NhZ2U/XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICBlbHNlIGlmIHR5cGVvZiBtZXNzYWdlID09ICdmdW5jdGlvbidcclxuICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlKClcclxuICAgICAgICAgIGlmIGZpbmRNZXNzYWdlKG1lc3NhZ2UpXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgICAgZWxzZSBpZiBBcnJheS5pc0FycmF5KG1lc3NhZ2UpXHJcbiAgICAgICAgICBmb3Igc3ViTWVzc2FnZSBpbiBtZXNzYWdlXHJcbiAgICAgICAgICAgIGlmIGZpbmRNZXNzYWdlKHN1Yk1lc3NhZ2UpXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgICBlbHNlIGlmIHR5cGVvZiBtZXNzYWdlID09ICdzdHJpbmcnIG9yIHR5cGVvZiBtZXNzYWdlID09ICdvYmplY3QnXHJcbiAgICAgICAgICBmaXJzdE1lc3NhZ2UgPSBtZXNzYWdlXHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgIGNvbnNvbGU/LmFzc2VydD8oZmFsc2UsICdpbnZhbGlkIGVycm9yIG1lc3NhZ2UnKVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuXHJcbiAgICAgIGZvciBvd24gaWQsIG1lc3NhZ2Ugb2YgX2Vycm9ycygpXHJcbiAgICAgICAgaWYgZmluZE1lc3NhZ2UobWVzc2FnZSlcclxuICAgICAgICAgIHJldHVybiBmaXJzdE1lc3NhZ2VcclxuXHJcbiAgICAgIHJldHVybiB1bmRlZmluZWRcclxuXHJcbiAgICAjIFNldCBhIHNpbmdsZSBlcnJvciwgY2xlYXJpbmcgb3RoZXIgZXJyb3JzXHJcbiAgICB0YXJnZXQuZXJyb3JzLnNldCA9IChtZXNzYWdlKSAtPlxyXG4gICAgICBpZiBtZXNzYWdlP1xyXG4gICAgICAgIGlkID0gKytfaWRDb3VudGVyXHJcblxyXG4gICAgICBlcnJvcnMgPSB7fVxyXG4gICAgICBtZXRhRGF0YSA9IF9lcnJvck1ldGFEYXRhKGVycm9ycywgaWQsIG1lc3NhZ2UpXHJcbiAgICAgIF9lcnJvcnMoZXJyb3JzKVxyXG4gICAgICByZXR1cm4gbWV0YURhdGFcclxuXHJcbiAgICB0YXJnZXQuZXJyb3JzLmhhcyA9ICgpIC0+XHJcbiAgICAgIHJldHVybiB0YXJnZXQuZXJyb3IoKT9cclxuXHJcbiAgICAjIENsZWFyIGFsbCB0aGUgY3VycmVudCBlcnJvcnNcclxuICAgIHRhcmdldC5lcnJvcnMuY2xlYXIgPSAoKSAtPlxyXG4gICAgICBfZXJyb3JzKHt9KVxyXG4gICAgICByZXR1cm5cclxuXHJcbiAgICAjIEdldCB0aGUgZmlyc3QgZXJyb3IsIG9yIFNldCBhIHNpbmdsZSBlcnJvciB3aGlsc3QgY2xlYXJpbmcgb3RoZXIgZXJyb3JzXHJcbiAgICB0YXJnZXQuZXJyb3IgPSBrby5wdXJlQ29tcHV0ZWQoe1xyXG4gICAgICByZWFkOiB0YXJnZXQuZXJyb3JzLmdldFxyXG4gICAgICB3cml0ZTogdGFyZ2V0LmVycm9ycy5zZXRcclxuICAgIH0pXHJcblxyXG4gICAgIyBSZXR1cm4gdHJ1ZSBpZmYgdGhlcmUgYXJlIGFueSBlcnJvcnNcclxuICAgIHRhcmdldC5oYXNFcnJvciA9IGtvLnB1cmVDb21wdXRlZCh7XHJcbiAgICAgIHJlYWQ6IHRhcmdldC5lcnJvcnMuaGFzXHJcbiAgICB9KVxyXG5cclxuICAgICMgUmVtb3ZlIGZhbGxpYmxlIGRhdGEgZnJvbSB0aGUgdGFyZ2V0IG9iamVjdFxyXG4gICAgdGFyZ2V0Ll9kaXNwb3NlRmFsbGlibGUgPSAoKSAtPlxyXG4gICAgICBfZXJyb3JzKHt9KVxyXG4gICAgICBkZWxldGUgdGFyZ2V0LmVycm9yXHJcbiAgICAgIGRlbGV0ZSB0YXJnZXQuZXJyb3JzXHJcbiAgICAgIGRlbGV0ZSB0YXJnZXQuaGFzRXJyb3JcclxuICAgICAgZGVsZXRlIHRhcmdldC5fZGlzcG9zZUZhbGxpYmxlXHJcbiAgICAgIHJldHVyblxyXG5cclxuICAgIHJldHVybiB0YXJnZXRcclxuXHJcbiAgIyBEZXRlcm1pbmUgaWYgaXRlbSBpcyBmYWxsaWJsZVxyXG4gIGtvLmV4dGVuZGVycy5mYWxsaWJsZS5pc0ZhbGxpYmxlID0gKHRhcmdldCkgLT5cclxuICAgIHJldHVybiB0YXJnZXQuZXJyb3JzPyBhbmQgdGFyZ2V0LmVycm9yP1xyXG5cclxuICBrby5wdXJlRXJyb3JzID0gKHJlYWQsIG93bmVyKSAtPlxyXG4gICAgc3Vic2NyaXB0aW9uID0gdW5kZWZpbmVkXHJcblxyXG4gICAgY29tcHV0ZWQgPSBrby5wdXJlQ29tcHV0ZWQoXHJcbiAgICAgICgpIC0+XHJcbiAgICAgICAgZXJyb3JzID0gW11cclxuICAgICAgICBhZGRFcnJvciA9ICh0YXJnZXQsIG1lc3NhZ2UpIC0+XHJcbiAgICAgICAgICBpZiB0YXJnZXQ/XHJcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5leHRlbmQoeyBmYWxsaWJsZTogdHJ1ZSB9KVxyXG4gICAgICAgICAgICBlcnJvcnMucHVzaCh0YXJnZXQuZXJyb3JzLmFkZChtZXNzYWdlKSlcclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgZXJyb3JzLnB1c2goe1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VcclxuICAgICAgICAgICAgICBkaXNwb3NlOiAoKSAtPiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICBpc0Rpc3Bvc2VkOiAoKSAtPiB0cnVlXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgcmV0dXJuXHJcblxyXG4gICAgICAgIGRpc3Bvc2UgPSAoKSAtPlxyXG4gICAgICAgICAgZm9yIGVycm9yIGluIGVycm9yc1xyXG4gICAgICAgICAgICBlcnJvci5kaXNwb3NlKClcclxuICAgICAgICAgIGVycm9ycyA9IFtdXHJcbiAgICAgICAgICBzdWJzY3JpcHRpb24uZGlzcG9zZSgpXHJcbiAgICAgICAgICBzdWJzY3JpcHRpb24gPSB1bmRlZmluZWRcclxuICAgICAgICAgIHJldHVyblxyXG5cclxuICAgICAgICB0cnlcclxuICAgICAgICAgIHJlYWQuY2FsbChvd25lciwgYWRkRXJyb3IpXHJcbiAgICAgICAgZmluYWxseVxyXG4gICAgICAgICAgc3Vic2NyaXB0aW9uID0gY29tcHV0ZWQuc3Vic2NyaWJlKGRpc3Bvc2UsIG51bGwsICdhc2xlZXAnKVxyXG5cclxuICAgICAgICByZXR1cm4gZXJyb3JzXHJcbiAgICApXHJcblxyXG4gICAgcmV0dXJuIGNvbXB1dGVkXHJcblxyXG4gIHJldHVybiBrb1xyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
